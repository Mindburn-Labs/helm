{
  "audit_id": "HELM-AUDIT-2026-02-17",
  "findings": [
    {
      "id": "SEC-001",
      "severity": "HIGH",
      "title": "Non-Canonical Hashing in ProofGraph Nodes",
      "file": "core/pkg/proofgraph/node.go",
      "line_range": "L74-88",
      "description": "ComputeNodeHash() uses json.NewEncoder instead of canonicalize.JCS(). The json.Encoder may produce non-RFC-8785-compliant output (key ordering depends on struct field declaration order, not lexicographic sorting). This creates a cross-platform hash inconsistency risk.",
      "evidence": "json.NewEncoder(buffer) with enc.SetEscapeHTML(false) followed by bytes.TrimSpace — different from canonicalize.JCS() which uses marshalRecursive with sort.Strings(keys)",
      "recommendation": "Replace json.Encoder path with canonicalize.JCS(temp) + canonicalize.HashBytes(data)",
      "cwe": "CWE-327 (Use of a Broken or Risky Cryptographic Algorithm)"
    },
    {
      "id": "SEC-002",
      "severity": "MEDIUM",
      "title": "Evidence Bundle Not Sealed with JCS",
      "file": "core/pkg/evidence/exporter.go",
      "line_range": "L160",
      "description": "sealBundle() uses json.Marshal(payload) for signature computation instead of canonicalize.JCS(payload). Bundle signatures are non-deterministic across platforms.",
      "evidence": "msg, err := json.Marshal(payload) on L160",
      "recommendation": "Use canonicalize.JCS(payload) for deterministic sealing",
      "cwe": "CWE-327"
    },
    {
      "id": "SEC-003",
      "severity": "MEDIUM",
      "title": "Wall-Clock Time Violation in SafeExecutor",
      "file": "core/pkg/executor/executor.go",
      "line_range": "L242, L298",
      "description": "SafeExecutor uses time.Now() for intent expiry check and receipt timestamps, violating KERNEL_TCB §3 which requires authority clock injection. Guardian correctly uses g.clock.Now() but Executor does not.",
      "evidence": "L242: time.Now().After(intent.ExpiresAt) — L298: Timestamp: time.Now()",
      "recommendation": "Inject Clock interface into SafeExecutor, replace time.Now() calls",
      "cwe": "CWE-330 (Use of Insufficiently Random Values)"
    },
    {
      "id": "SEC-004",
      "severity": "LOW",
      "title": "Duplicate Assignment in SignDecision",
      "file": "core/pkg/crypto/signer.go",
      "line_range": "L94-95",
      "description": "d.Signature = sig appears on two consecutive lines. Harmless but indicates copy-paste error.",
      "evidence": "Line 94: d.Signature = sig  Line 95: d.Signature = sig",
      "recommendation": "Remove duplicate line",
      "cwe": "CWE-561 (Dead Code)"
    },
    {
      "id": "SEC-005",
      "severity": "LOW",
      "title": "Swallowed Audit Error in Metering",
      "file": "core/pkg/executor/executor.go",
      "line_range": "L193-199",
      "description": "Metering errors logged to audit trail using _ = e.AuditLog.Append(), discarding the audit append error. By design (metering non-fatal) but creates a silent failure path.",
      "evidence": "_ = e.AuditLog.Append(\"executor\", \"metering_error\", ...)",
      "recommendation": "Document this as intentional behavior; consider logging the audit append failure",
      "cwe": "CWE-390 (Detection of Error Condition Without Action)"
    }
  ],
  "positive_findings": [
    {
      "id": "POS-001",
      "title": "Comprehensive Fail-Closed Design",
      "evidence": "All Guardian/Executor error paths return errors or sign FAIL verdicts. No silent pass-through."
    },
    {
      "id": "POS-002",
      "title": "Authority Clock in Guardian",
      "evidence": "guardian.go L17-23 documents KERNEL_TCB §3; L179 uses g.clock.Now() for timestamps."
    },
    {
      "id": "POS-003",
      "title": "Audit Failure as Hard Error",
      "evidence": "guardian.go L324-328: if AuditLog.Append fails, decision is rejected entirely."
    },
    {
      "id": "POS-004",
      "title": "Intent Expiry + Tool Constraint",
      "evidence": "AuthorizedExecutionIntent has ExpiresAt (5min), AllowedTool field. Executor validates both."
    },
    {
      "id": "POS-005",
      "title": "Output Drift Detection",
      "evidence": "executor.go L128-136: ValidateAndCanonicalizeToolOutput with ERR_CONNECTOR_CONTRACT_DRIFT."
    }
  ]
}
